{
  "openapi": "3.0.1",
  "info": {
    "title": "Mailing Automation API - recipients",
    "contact": {
      "url": "https://www.deutschepost.de/de/d/dialogpost/dialogmarketing.html",
      "email": "it-csp@deutschepost.de"
    },
    "version": "1"
  },
  "servers": [
    {
      "url": "http://service-recipientmanagement-develop:8080/recipientmanagement",
      "description": "Generated server url"
    }
  ],
  "tags": [
    {
      "name": "recipientreport",
      "description": "The Recipient Report Resource"
    },
    {
      "name": "recipients",
      "description": "The Recipient Resource"
    }
  ],
  "paths": {
    "/recipients": {
      "get": {
        "tags": [
          "recipients"
        ],
        "summary": "Gets the recipients of a long term campaign.",
        "operationId": "getRecipients",
        "parameters": [
          {
            "name": "pageable",
            "in": "query",
            "required": true,
            "schema": {
              "$ref": "#/components/schemas/Pageable"
            }
          },
          {
            "name": "assembler",
            "in": "query",
            "required": true,
            "schema": {
              "$ref": "#/components/schemas/PagedResourcesAssemblerCampaignRecipientEntity"
            }
          },
          {
            "name": "customerId",
            "in": "query",
            "description": "The ID of the customer.",
            "required": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "campaignId",
            "in": "query",
            "description": "The ID of the campaign.",
            "required": true,
            "schema": {
              "type": "integer",
              "format": "int64"
            }
          },
          {
            "name": "recipientPackageId",
            "in": "query",
            "description": "The ID of the recipient package.",
            "required": true,
            "schema": {
              "type": "integer",
              "format": "int64"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "The recipients are returned.",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CollectionRepCampaignRecipientRep"
                }
              }
            }
          },
          "404": {
            "description": "The campaign or the recipient package does not exist.",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CollectionRepCampaignRecipientRep"
                }
              }
            }
          }
        }
      },
      "post": {
        "tags": [
          "recipients"
        ],
        "summary": "Accept recipients of a campaign.",
        "description": "Requires authorities ROLE_PMP_LONG_TERM_CAMPAIGN_PARTNER_SYSTEM or ROLE_PMP_ADMIN",
        "operationId": "acceptRecipients",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/AcceptRecipientsRep"
              }
            }
          },
          "required": true
        },
        "responses": {
          "202": {
            "description": "Successfully accepted recipients. Find the correlationId for your request in the response field 'correlationId'.",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "additionalProperties": {
                    "type": "string"
                  }
                }
              }
            }
          },
          "422": {
            "description": "Recipients not accepted. DM_RC_0304 Campaign is not active. DM_RC_0308 Campaign is not of type LONG_TERM.",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "additionalProperties": {
                    "type": "string"
                  }
                }
              }
            }
          }
        }
      }
    },
    "/recipientreport/overview": {
      "get": {
        "tags": [
          "recipientreport"
        ],
        "summary": "Returns recipient report data.",
        "description": "QueryParams: pageNumber = page; pageSize = size; sort={Id of sort field},asc or desc",
        "operationId": "getRecipientOverviewReport",
        "parameters": [
          {
            "name": "customerId",
            "in": "query",
            "description": "The ID of the customer.",
            "required": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "campaignId",
            "in": "query",
            "description": "The ID of the campaign.",
            "required": true,
            "schema": {
              "type": "integer",
              "format": "int64"
            }
          },
          {
            "name": "predicate",
            "in": "query",
            "description": "Predicate of class RecipientReportEntryEntity",
            "required": true,
            "schema": {
              "$ref": "#/components/schemas/Predicate"
            }
          },
          {
            "name": "pageable",
            "in": "query",
            "description": "Pageable: pageNumber = page; pageSize = size;",
            "required": true,
            "schema": {
              "$ref": "#/components/schemas/Pageable"
            }
          },
          {
            "name": "assembler",
            "in": "query",
            "required": true,
            "schema": {
              "$ref": "#/components/schemas/PagedResourcesAssemblerRecipientReportEntryEntity"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "The recipient report is returned.",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/RecipientReportOverviewRep"
                }
              }
            }
          }
        }
      }
    },
    "/recipientreport/detail": {
      "get": {
        "tags": [
          "recipientreport"
        ],
        "summary": "Gets the recipient error report of a day as CSV file.",
        "description": "A report day usually reaches from 20:00 UTC of one day to 20:00 UTC of the next day.",
        "operationId": "getRecipientReportCSV",
        "parameters": [
          {
            "name": "customerId",
            "in": "query",
            "description": "The ID of the customer.",
            "required": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "campaignId",
            "in": "query",
            "description": "The ID of the campaign.",
            "required": true,
            "schema": {
              "type": "integer",
              "format": "int64"
            }
          },
          {
            "name": "reportDate",
            "in": "query",
            "description": "The report date.",
            "required": true,
            "schema": {
              "type": "string",
              "format": "date"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "CSV file content returned.",
            "content": {
              "text/csv": {
                "schema": {
                  "type": "array",
                  "items": {
                    "type": "string",
                    "format": "byte"
                  }
                }
              }
            }
          },
          "404": {
            "description": "The campaign was not found.",
            "content": {
              "text/csv": {
                "schema": {
                  "type": "array",
                  "items": {
                    "type": "string",
                    "format": "byte"
                  }
                }
              }
            }
          },
          "422": {
            "description": "DM_RC_0001: The campaign has no variable definitions yet.",
            "content": {
              "text/csv": {
                "schema": {
                  "type": "array",
                  "items": {
                    "type": "string",
                    "format": "byte"
                  }
                }
              }
            }
          }
        }
      }
    }
  },
  "components": {
    "schemas": {
      "Pageable": {
        "type": "object",
        "properties": {
          "sort": {
            "$ref": "#/components/schemas/Sort"
          },
          "offset": {
            "type": "integer",
            "format": "int64"
          },
          "paged": {
            "type": "boolean"
          },
          "unpaged": {
            "type": "boolean"
          },
          "pageNumber": {
            "type": "integer",
            "format": "int32"
          },
          "pageSize": {
            "type": "integer",
            "format": "int32"
          }
        }
      },
      "Sort": {
        "type": "object",
        "properties": {
          "unsorted": {
            "type": "boolean"
          },
          "sorted": {
            "type": "boolean"
          },
          "empty": {
            "type": "boolean"
          }
        }
      },
      "PagedResourcesAssemblerCampaignRecipientEntity": {
        "type": "object",
        "properties": {
          "forceFirstAndLastRels": {
            "type": "boolean",
            "writeOnly": true
          }
        }
      },
      "CampaignRecipientRep": {
        "required": [
          "city",
          "zip"
        ],
        "type": "object",
        "properties": {
          "companyName": {
            "maxLength": 40,
            "minLength": 0,
            "type": "string",
            "description": "The company name."
          },
          "salutation": {
            "maxLength": 30,
            "minLength": 0,
            "type": "string",
            "description": "The salutation."
          },
          "title": {
            "maxLength": 30,
            "minLength": 0,
            "type": "string",
            "description": "The title."
          },
          "firstName": {
            "maxLength": 30,
            "minLength": 0,
            "type": "string",
            "description": "The first name."
          },
          "lastName": {
            "maxLength": 40,
            "minLength": 0,
            "type": "string",
            "description": "The last name."
          },
          "street": {
            "maxLength": 30,
            "minLength": 0,
            "type": "string",
            "description": "The street."
          },
          "housenumber": {
            "maxLength": 10,
            "minLength": 0,
            "type": "string",
            "description": "The house number."
          },
          "postBox": {
            "maxLength": 7,
            "minLength": 0,
            "type": "string",
            "description": "The PO-box."
          },
          "zip": {
            "maxLength": 5,
            "minLength": 5,
            "type": "string",
            "description": "The ZIP code."
          },
          "city": {
            "maxLength": 30,
            "minLength": 2,
            "type": "string",
            "description": "The city."
          },
          "recipientIdExt": {
            "type": "string",
            "description": "The ID in the partner system."
          },
          "variableValues": {
            "type": "array",
            "description": "Variable values.",
            "items": {
              "$ref": "#/components/schemas/CampaignRecipientVariableValueRep"
            }
          }
        }
      },
      "CampaignRecipientVariableValueRep": {
        "type": "object",
        "properties": {
          "id": {
            "type": "integer",
            "description": "The variable value ID (corresponding to variable definition ID).",
            "format": "int64"
          },
          "value": {
            "maxLength": 255,
            "minLength": 0,
            "type": "string",
            "description": "The value."
          }
        },
        "description": "Variable values."
      },
      "CollectionRepCampaignRecipientRep": {
        "type": "object",
        "properties": {
          "elements": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/CampaignRecipientRep"
            }
          },
          "page": {
            "$ref": "#/components/schemas/PageMetadata"
          },
          "links": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/Link"
            }
          }
        }
      },
      "Link": {
        "type": "object",
        "properties": {
          "rel": {
            "type": "string"
          },
          "href": {
            "type": "string"
          },
          "hreflang": {
            "type": "string"
          },
          "media": {
            "type": "string"
          },
          "title": {
            "type": "string"
          },
          "type": {
            "type": "string"
          },
          "deprecation": {
            "type": "string"
          },
          "profile": {
            "type": "string"
          },
          "name": {
            "type": "string"
          }
        }
      },
      "PageMetadata": {
        "type": "object",
        "properties": {
          "size": {
            "type": "integer",
            "format": "int64"
          },
          "totalElements": {
            "type": "integer",
            "format": "int64"
          },
          "totalPages": {
            "type": "integer",
            "format": "int64"
          },
          "number": {
            "type": "integer",
            "format": "int64"
          }
        }
      },
      "AcceptRecipientDataRep": {
        "required": [
          "label",
          "value"
        ],
        "type": "object",
        "properties": {
          "label": {
            "type": "string",
            "description": "The label of a variable definition."
          },
          "value": {
            "type": "string",
            "description": "The concrete value for a variable definition."
          }
        },
        "description": "The variable definition data for one single recipient. The maximum number of recipient data is 100."
      },
      "AcceptRecipientRep": {
        "required": [
          "recipientData"
        ],
        "type": "object",
        "properties": {
          "recipientData": {
            "maxItems": 100,
            "minItems": 1,
            "type": "array",
            "description": "The variable definition data for one single recipient. The maximum number of recipient data is 100.",
            "items": {
              "$ref": "#/components/schemas/AcceptRecipientDataRep"
            }
          },
          "recipientIdExt": {
            "type": "string",
            "description": "Any id from your system to refer to this particular data entry. If given, it will be used to delete duplicate recipients. Can be null."
          }
        },
        "description": "Recipient object containing the recipient data (address, custom) for several recipients. The maximum number of recipient data is 100."
      },
      "AcceptRecipientsRep": {
        "required": [
          "campaignId",
          "customerId",
          "recipients"
        ],
        "type": "object",
        "properties": {
          "campaignId": {
            "type": "integer",
            "description": "The Id of a campaign.",
            "format": "int64"
          },
          "customerId": {
            "type": "string",
            "description": "The Id of a customer."
          },
          "recipients": {
            "maxItems": 100,
            "minItems": 1,
            "type": "array",
            "description": "Recipient object containing the recipient data (address, custom) for several recipients. The maximum number of recipient data is 100.",
            "items": {
              "$ref": "#/components/schemas/AcceptRecipientRep"
            }
          }
        }
      },
      "Predicate": {
        "type": "object"
      },
      "PagedResourcesAssemblerRecipientReportEntryEntity": {
        "type": "object",
        "properties": {
          "forceFirstAndLastRels": {
            "type": "boolean",
            "writeOnly": true
          }
        }
      },
      "CollectionRepRecipientReportOverviewEntryRep": {
        "type": "object",
        "properties": {
          "elements": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/RecipientReportOverviewEntryRep"
            }
          },
          "page": {
            "$ref": "#/components/schemas/PageMetadata"
          },
          "links": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/Link"
            }
          }
        },
        "description": "The list of report overview entries"
      },
      "RecipientReportOverviewEntryRep": {
        "type": "object",
        "properties": {
          "reportDate": {
            "type": "string",
            "description": "The date of the reporting.",
            "format": "date"
          },
          "totalAmountPerDay": {
            "type": "integer",
            "description": "The sum of mailings per day (with or without errors",
            "format": "int64"
          },
          "totalAmountSentPerDay": {
            "type": "integer",
            "description": "The amount of mailings sent per day without errors",
            "format": "int64"
          },
          "totalAmountErrorsPerDay": {
            "type": "integer",
            "description": "The amount of mailings with errors per day",
            "format": "int64"
          }
        }
      },
      "RecipientReportOverviewRep": {
        "type": "object",
        "properties": {
          "totalAmount": {
            "type": "integer",
            "description": "The total amount of mailings for the campaign for all times",
            "format": "int64"
          },
          "totalAmountSent": {
            "type": "integer",
            "description": "The total amount of sent mailings for the campaign for all times",
            "format": "int64"
          },
          "entryList": {
            "$ref": "#/components/schemas/CollectionRepRecipientReportOverviewEntryRep"
          }
        }
      }
    }
  }
}